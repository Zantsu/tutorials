<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>curl-tutorial.sh</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="curl-tutorial.html">curl-tutorial.sh</a>
          <a class="source" href="g5k-campaign-tutorial.html">g5k-campaign-tutorial.rb</a>
          <a class="source" href="resources-status-2.0.html">resources-status-2.0.rb</a>
          <a class="source" href="restfully-tutorial.html">restfully-tutorial.rb</a>
          <a class="source" href="../sid/resources-status-sid.html">resources-status-sid.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>curl-tutorial.sh</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>This tutorial will show you how to use the <a href="http://man.cx/curl">cURL</a> 
command-line tool to issue one-shot requests against the Grid'5000 API.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Prerequisites'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Prerequisites">&#182;</a>
        </div>
        <h2>Prerequisites</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>You&rsquo;ll need the cURL command-line tool. If it&rsquo;s not already installed, 
use your package manager to fetch it. E.g.:</p>

<pre><code>sudo apt-get install curl
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Let&amp;rsquo;s_do_some_cURLing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Let&amp;rsquo;s_do_some_cURLing">&#182;</a>
        </div>
        <h2>Let&rsquo;s do some cURLing</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Test that you can access the Grid'5000 API. Replace <code>login</code>
with your Grid'5000 login. Your Grid'5000 password will be requested when
you hit <code>enter</code>.
The output of the command should be:</p>

<pre><code>curl -ki -u login https://api.grid5000.fr/2.0/grid5000/sites/\
rennes
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre>     HTTP/1.1 200 OK
     Date: Mon, 04 Apr 2011 09:22:37 GMT
     Vary: Accept,Accept-Encoding
     ETag: <span class="s2">&quot;f1930ff4bc894f7fa076ce8f2e029e1c6a4adfe7&quot;</span>
     Allow: GET
     Cache-Control: public, must-revalidate, proxy-revalidate, max-age<span class="o">=</span>60, s-maxage<span class="o">=</span>60
     Last-Modified: Fri, 01 Apr 2011 15:38:10 GMT
     Content-Length: 2366
     Status: 200
     Content-Type: application/vnd.fr.grid5000.api.site+json;level<span class="o">=</span>1
   
     <span class="o">{</span>
       <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;Rennes&quot;</span>,
       <span class="s2">&quot;latitude&quot;</span>: 48.1,
       <span class="s2">&quot;location&quot;</span>: <span class="s2">&quot;Rennes, France&quot;</span>,
       <span class="s2">&quot;security_contact&quot;</span>: <span class="s2">&quot;rennes-staff@lists.grid5000.fr&quot;</span>,
       <span class="s2">&quot;uid&quot;</span>: <span class="s2">&quot;rennes&quot;</span>,
       <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;site&quot;</span>,
       <span class="s2">&quot;user_support_contact&quot;</span>: <span class="s2">&quot;rennes-staff@lists.grid5000.fr&quot;</span>,
       <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;a650e837fbc8a4fbcc403ad25aa82cceab7babe4&quot;</span>,
       <span class="s2">&quot;links&quot;</span>: <span class="o">[</span>
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/versions/a650e837fbc8a4fbcc403ad25aa82cceab7babe4&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;version&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;member&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Version+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/versions&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;versions&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;self&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Site+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/clusters&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;clusters&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/environments&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;environments&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;parent&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Grid+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/status&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;status&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/metrics&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;metrics&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/jobs&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;jobs&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/deployments&quot;</span>,
           <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;deployments&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;collection&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Collection+json;level=1&quot;</span>
         <span class="o">}</span>
       <span class="o">]</span>,
       <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;&quot;</span>,
       <span class="s2">&quot;longitude&quot;</span>: -1.6667,
       <span class="s2">&quot;compilation_server&quot;</span>: <span class="nb">false</span>,
       <span class="s2">&quot;email_contact&quot;</span>: <span class="s2">&quot;rennes-staff@lists.grid5000.fr&quot;</span>,
       <span class="s2">&quot;web&quot;</span>: <span class="s2">&quot;http://www.irisa.fr&quot;</span>,
       <span class="s2">&quot;sys_admin_contact&quot;</span>: <span class="s2">&quot;rennes-staff@lists.grid5000.fr&quot;</span>
     <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>What you just did was getting the description of the <code>rennes</code> site. 
The response is <a href="http://json.org/">JSON</a> formatted (JSON is a lightweight 
data interchange format), and contains a list of <code>links</code> to related
resources.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>If you want to avoid entering your credentials for every request, <code>cURL</code> can 
use a configuration file (<code>~/.netrc</code>) to store them.
Then, you just have to pass the <code>-n</code> flag to <code>cURL</code> so that it takes it into account.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>cat <span class="s">&lt;&lt;EOF &gt;&gt; ~/.netrc</span>
<span class="s">machine api.grid5000.fr</span>
<span class="s">login your-grid5000-login</span>
<span class="s">password your-grid5000-password</span>
<span class="s">EOF</span>
chmod 600 ~/.netrc</pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Retry the previous request with the <code>-n</code> flag, and you should get the same result.</p>

<pre><code>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>If you want to see the full details of how the HTTP request is made, add the 
<code>-v</code> flag to the command (lines prefixed with <code>&gt;</code> and <code>&lt;</code> repectively show 
what is sent to, and received from the server):</p>

<pre><code>curl -kvni https://api.grid5000.fr/2.0/grid5000/sites/rennes
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Looking at the list of <code>links</code> in the description of the <code>rennes</code> site, 
you can see that there is a lot of other URIs that can be followed.
As an example, you can retrieve the site status with the following command.
For each node, you&rsquo;ll see the node state and the next reservation.
You can have a look at the <a href="https://api.grid5000.fr/2.0/status/help/index.html">Monitoring API documentation</a> 
for more information.</p>

<pre><code>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes/\
status
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>You can also fetch the list of scheduled jobs on the <code>rennes</code> site by 
issuing a request to the following URI.
Note that you can remove the <code>-i</code> flag if you do not want to display the
HTTP headers from the response.</p>

<pre><code>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes/jobs
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>At this point, you may want to add your very own job to the previous list.
Use the <code>POST</code> method to create a new job that just sleeps for 30 minutes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -kni -X POST https://api.grid5000.fr/2.0/grid5000/sites/rennes/jobs -d <span class="s2">&quot;command=sleep 1800&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>You should get back a response like the following:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>     HTTP/1.1 201 Created
     Date: Mon, 04 Apr 2011 09:51:39 GMT
     Location: /2.0/grid5000/sites/rennes/jobs/381093
     Content-Type: application/json
     Content-Length: 337
     Vary: Accept-Encoding
   
     <span class="o">{</span>
       <span class="s2">&quot;uid&quot;</span>: 381093,
       <span class="s2">&quot;links&quot;</span>: <span class="o">[</span>
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/jobs/381093&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;self&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Job+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;parent&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Site+json;level=1&quot;</span>
         <span class="o">}</span>
       <span class="o">]</span>
     <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Have a look at the <a href="https://api.grid5000.fr/2.0/jobs/help/index.html">Jobs API documentation</a>
to see the full list of available parameters and usage.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Notice the <code>201 Created</code> status code and the <code>Location</code> HTTP header in the previous response. 
The latter indicates where the full job description can be fetched. 
So let&rsquo;s see what we get:</p>

<pre><code>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes\
/jobs/381093
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre>     HTTP/1.1 200 OK
     Date: Mon, 04 Apr 2011 09:55:00 GMT
     Content-Type: application/json
     Content-Length: 790
     Expires: Mon, 04 Apr 2011 09:55:30 GMT
     Allow: GET, DELETE
     Vary: Accept-Encoding
   
     <span class="o">{</span>
       <span class="s2">&quot;assigned_nodes&quot;</span>: <span class="o">[</span>
         <span class="s2">&quot;paramount-7.rennes.grid5000.fr&quot;</span>
       <span class="o">]</span>,
       <span class="s2">&quot;directory&quot;</span>: <span class="s2">&quot;/home/crohr&quot;</span>,
       <span class="s2">&quot;command&quot;</span>: <span class="s2">&quot;sleep 1800&quot;</span>,
       <span class="s2">&quot;mode&quot;</span>: <span class="s2">&quot;PASSIVE&quot;</span>,
       <span class="s2">&quot;walltime&quot;</span>: 3600,
       <span class="s2">&quot;submitted_at&quot;</span>: 1301910701,
       <span class="s2">&quot;project&quot;</span>: <span class="s2">&quot;default&quot;</span>,
       <span class="s2">&quot;events&quot;</span>: <span class="o">[</span>
   
       <span class="o">]</span>,
       <span class="s2">&quot;uid&quot;</span>: 381093,
       <span class="s2">&quot;user_uid&quot;</span>: <span class="s2">&quot;crohr&quot;</span>,
       <span class="s2">&quot;links&quot;</span>: <span class="o">[</span>
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes/jobs/381093&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;self&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Job+json;level=1&quot;</span>
         <span class="o">}</span>,
         <span class="o">{</span>
           <span class="s2">&quot;href&quot;</span>: <span class="s2">&quot;/2.0/grid5000/sites/rennes&quot;</span>,
           <span class="s2">&quot;rel&quot;</span>: <span class="s2">&quot;parent&quot;</span>,
           <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;application/vnd.fr.grid5000.api.Site+json;level=1&quot;</span>
         <span class="o">}</span>
       <span class="o">]</span>,
       <span class="s2">&quot;types&quot;</span>: <span class="o">[</span>
   
       <span class="o">]</span>,
       <span class="s2">&quot;queue&quot;</span>: <span class="s2">&quot;default&quot;</span>,
       <span class="s2">&quot;started_at&quot;</span>: 1301910702,
       <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;FIFO scheduling OK&quot;</span>,
       <span class="s2">&quot;scheduled_at&quot;</span>: 1301910702,
       <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;running&quot;</span>,
       <span class="s2">&quot;properties&quot;</span>: <span class="s2">&quot;maintenance = &#39;NO&#39;&quot;</span>
     <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>We can see that our job is <code>running</code> on the node <code>paramount-7.rennes.grid5000.fr</code>.
Since it does not do anything useful, we can kill it by issuing a <code>DELETE</code> request on its URI.
You should get back a <code>202 Accepted</code> response:</p>

<pre><code>curl -kni -X DELETE https://api.grid5000.fr/2.0/grid5000/sites/\
rennes/jobs/381093
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre>     HTTP/1.1 202 Accepted
     Date: Mon, 04 Apr 2011 09:57:11 GMT
     Content-Type: application/json
     Content-Length: 0
     X-Oar-Info: Deleting the <span class="nv">job</span> <span class="o">=</span> 381093 ...REGISTERED. The job<span class="o">(</span>s<span class="o">)</span> <span class="o">[</span> 381093 <span class="o">]</span> will be deleted in a near future.
     Vary: Accept-Encoding</pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>This concludes our short tour of using the Grid'5000 API with cURL.
You will find many more examples in the respective documentation of each API.
See <a href="https://api.grid5000.fr">https://api.grid5000.fr</a> for links to the documentation.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>

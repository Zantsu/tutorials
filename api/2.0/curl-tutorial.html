<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>curl-tutorial.sh</title>
  <link rel="stylesheet" href="http://github.com/jashkenas/docco/raw/0.3.0/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="curl-tutorial.html">curl-tutorial.sh</a>
          <a class="source" href="g5k-campaign-tutorial.html">g5k-campaign-tutorial.rb</a>
          <a class="source" href="restfully-tutorial.html">restfully-tutorial.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>curl-tutorial.sh</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>This tutorial will show you how to use the <a href="http://man.cx/curl">cURL</a>
command-line tool to issue one-shot requests against the Grid'5000 API.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Prerequisites'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Prerequisites">&#182;</a>
        </div>
        <h2>Prerequisites</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>You&rsquo;ll need the cURL command-line tool. If it&rsquo;s not already installed,
use your package manager to fetch it. E.g.:</p>

<pre><code>sudo apt-get install curl
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Let&amp;rsquo;s_do_some_cURLing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Let&amp;rsquo;s_do_some_cURLing">&#182;</a>
        </div>
        <h2>Let&rsquo;s do some cURLing</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Test that you can access the Grid'5000 API. Replace <code>login</code> and <code>password</code>
with their respective value (your Grid'5000 credentials).
The output of the command should be:</p>

<pre><code>HTTP/1.1 200 OK
Date: Mon, 04 Apr 2011 09:22:37 GMT
Vary: Accept,Accept-Encoding
ETag: "f1930ff4bc894f7fa076ce8f2e029e1c6a4adfe7"
Allow: GET
Cache-Control: public, must-revalidate, proxy-revalidate, max-age=60, s-maxage=60
Last-Modified: Fri, 01 Apr 2011 15:38:10 GMT
Content-Length: 2366
Status: 200
Content-Type: application/vnd.fr.grid5000.api.site+json;level=1

{
  "name": "Rennes",
  "latitude": 48.1,
  "location": "Rennes, France",
  "security_contact": "rennes-staff@lists.grid5000.fr",
  "uid": "rennes",
  "type": "site",
  "user_support_contact": "rennes-staff@lists.grid5000.fr",
  "version": "a650e837fbc8a4fbcc403ad25aa82cceab7babe4",
  "links": [
    {
      "href": "/2.0/grid5000/sites/rennes/versions/a650e837fbc8a4fbcc403ad25aa82cceab7babe4",
      "title": "version",
      "rel": "member",
      "type": "application/vnd.fr.grid5000.api.Version+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/versions",
      "title": "versions",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes",
      "rel": "self",
      "type": "application/vnd.fr.grid5000.api.Site+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/clusters",
      "title": "clusters",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/environments",
      "title": "environments",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    },
    {
      "href": "/2.0/grid5000",
      "rel": "parent",
      "type": "application/vnd.fr.grid5000.api.Grid+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/status",
      "title": "status",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/metrics",
      "title": "metrics",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/jobs",
      "title": "jobs",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes/deployments",
      "title": "deployments",
      "rel": "collection",
      "type": "application/vnd.fr.grid5000.api.Collection+json;level=1"
    }
  ],
  "description": "",
  "longitude": -1.6667,
  "compilation_server": false,
  "email_contact": "rennes-staff@lists.grid5000.fr",
  "web": "http://www.irisa.fr",
  "sys_admin_contact": "rennes-staff@lists.grid5000.fr"
}
</code></pre>

<p>What you just did was getting the description of the <code>rennes</code> site.
The response is <a href="http://json.org/">JSON</a> formatted (JSON is a lightweight data
interchange format), and contains a list of <code>links</code> to related resources.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -ki -u login https://api.grid5000.fr/2.0/grid5000/sites/rennes</pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>If you want to avoid entering your credentials for every request, <code>cURL</code> can
use a configuration file (<code>~/.netrc</code>) to store them.
Then, you just have to pass the <code>-n</code> flag to <code>cURL</code> so that it takes it into account.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>cat <span class="s">&lt;&lt;EOF &gt;&gt; ~/.netrc</span>
<span class="s">machine api.grid5000.fr</span>
<span class="s">login your-grid5000-login</span>
<span class="s">password your-grid5000-password</span>
<span class="s">EOF</span>
chmod 600 ~/.netrc</pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Retry the previous request with the <code>-n</code> flag, and you should get the same result.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes</pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Now, as an example, you can fetch the list of scheduled jobs on the <code>rennes</code> site by issuing a request to the following URI.
Note that you can remove the <code>-i</code> flag if you do not want to display the HTTP headers from the response.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes/jobs</pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>At this point, you may want to add your very own job to the previous list.
Use the <code>POST</code> method to create a new job that just sleeps for 30 minutes.
You should get back a response like the following:</p>

<pre><code>HTTP/1.1 201 Created
Date: Mon, 04 Apr 2011 09:51:39 GMT
Location: /2.0/grid5000/sites/rennes/jobs/381093
Content-Type: application/json
Content-Length: 337
Vary: Accept-Encoding

{
  "uid": 381093,
  "links": [
    {
      "href": "/2.0/grid5000/sites/rennes/jobs/381093",
      "rel": "self",
      "type": "application/vnd.fr.grid5000.api.Job+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes",
      "rel": "parent",
      "type": "application/vnd.fr.grid5000.api.Site+json;level=1"
    }
  ]
}
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -kni -X POST https://api.grid5000.fr/2.0/grid5000/sites/rennes/jobs <span class="se">\</span>
-d <span class="s1">&#39;command=sleep 1800&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Notice the <code>201 Created</code> status code and the <code>Location</code> HTTP header in the previous response.
The latter indicates where the full job description can be fetched.
So let&rsquo;s see what we get:</p>

<pre><code>HTTP/1.1 200 OK
Date: Mon, 04 Apr 2011 09:55:00 GMT
Content-Type: application/json
Content-Length: 790
Expires: Mon, 04 Apr 2011 09:55:30 GMT
Allow: GET, DELETE
Vary: Accept-Encoding

{
  "assigned_nodes": [
    "paramount-7.rennes.grid5000.fr"
  ],
  "directory": "/home/crohr",
  "command": "sleep 1800",
  "mode": "PASSIVE",
  "walltime": 3600,
  "submitted_at": 1301910701,
  "project": "default",
  "events": [

  ],
  "uid": 381093,
  "user_uid": "crohr",
  "links": [
    {
      "href": "/2.0/grid5000/sites/rennes/jobs/381093",
      "rel": "self",
      "type": "application/vnd.fr.grid5000.api.Job+json;level=1"
    },
    {
      "href": "/2.0/grid5000/sites/rennes",
      "rel": "parent",
      "type": "application/vnd.fr.grid5000.api.Site+json;level=1"
    }
  ],
  "types": [

  ],
  "queue": "default",
  "started_at": 1301910702,
  "message": "FIFO scheduling OK",
  "scheduled_at": 1301910702,
  "state": "running",
  "properties": "maintenance = 'NO'"
}
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -kni https://api.grid5000.fr/2.0/grid5000/sites/rennes/jobs/381093</pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>We can see that our job is <code>running</code> on the node <code>paramount-7.rennes.grid5000.fr</code>.
Since it does not do anything useful, we can kill it by issuing a <code>DELETE</code> request on its URI.
You should get back a <code>202 Accepted</code> response:</p>

<pre><code>HTTP/1.1 202 Accepted
Date: Mon, 04 Apr 2011 09:57:11 GMT
Content-Type: application/json
Content-Length: 0
X-Oar-Info: Deleting the job = 381093 ...REGISTERED. The job(s) [ 381093 ] will be deleted in a near future.
Vary: Accept-Encoding
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre>curl -kni -X DELETE https://api.grid5000.fr/2.0/grid5000/sites/rennes/jobs/381093</pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>This concludes our short tour of using the Grid'5000 API with cURL.
You will find many more examples in the respective documentation of each API.
See <a href="https://api.grid5000.fr">https://api.grid5000.fr</a> for links to the documentation.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
